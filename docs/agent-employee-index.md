# Agent 员工指数功能文档

## 功能概述

Agent 员工指数是一个用于衡量用户使用 AI 完成任务效率的指标系统。通过追踪每个用户的 AI 任务执行时间，计算出员工指数（执行时间/总可用时间），并提供月度和累计排名。

## 核心概念

### 员工指数计算

**月度员工指数** = 本月 AI 任务执行时间 / (30天 × 24小时)

例如：
- 用户本月累计执行 AI 任务 100 小时
- 月度可用时间 = 30 × 24 = 720 小时
- 月度员工指数 = 100 / 720 = 0.1389 (13.89%)

**累计员工指数** = 总执行时间 / (注册天数 × 24小时)

### Agent 负荷

Agent 负荷表示相当于多少个全职 AI Agent 的工作量：
- 满负荷 Agent = 7×24×30 = 5040 小时/月
- Agent 负荷百分比 = (月度工作时间 / 5040) × 100%

## 技术实现

### 数据库结构

1. **agent_execution_logs** - 执行日志表
   - 记录每次任务执行的开始和结束时间
   - 计算执行时长

2. **agent_monthly_summary** - 月度汇总表
   - 缓存每个用户的月度统计
   - 提高查询性能

### API 端点

- `GET /api/agent/metrics` - 获取当前用户的指标
- `GET /api/agent/rankings?period=monthly|cumulative` - 获取排行榜
- `GET /api/agent/history/{user_id}` - 获取用户历史数据
- `GET /api/agent/company-stats` - 公司整体统计（管理员）

### 自动追踪

系统会自动在以下时机记录执行时间：
1. 使用快速任务功能时
2. 执行分支任务时
3. 通过 API 触发的任务执行

## 页面功能

### 个人指标展示
- 本月工作时长
- 本月完成任务数
- 月度员工指数
- 月度排名

### 排行榜
- 月度排行：按本月工作时长排序
- 累计排行：按总工作时长排序
- 显示前10名用户
- 高亮当前用户

### 历史趋势
- 近6个月的员工指数变化图表
- 每月详细数据表格

### 公司统计（管理员）
- 活跃用户数
- 总工作时长
- 平均工作时长
- 平均 Agent 负荷

## 使用指南

1. **查看个人指标**
   - 点击导航菜单中的"员工指数"
   - 查看个人月度和累计数据

2. **查看排行榜**
   - 切换"月度排行"和"累计排行"
   - 查看自己在公司中的排名

3. **分析历史趋势**
   - 切换到"历史趋势"标签
   - 查看过去6个月的变化

4. **管理员功能**
   - 查看公司整体统计
   - 手动触发指标更新

## 数据更新机制

- **实时更新**：每次任务执行完成后立即更新
- **月度汇总**：自动缓存月度数据，提高查询效率
- **手动刷新**：管理员可手动触发全量计算

## 最佳实践

1. **提高员工指数**
   - 多使用 AI 功能完成任务
   - 利用快速任务功能
   - 批量处理相关任务

2. **团队管理**
   - 定期查看团队整体指标
   - 识别高效率成员
   - 分享最佳实践

## 注意事项

1. 员工指数仅统计 AI 任务执行时间，不包括手动操作时间
2. 系统会自动过滤失败的任务，只统计成功完成的任务
3. 历史数据会永久保存，可用于长期分析